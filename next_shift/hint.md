## ヒント1

$N+1$ 日目以降は、 $M$ 人の生徒が周期的に選ばれます。ではその $1$ 周期がどのようになっているのか考えてみましょう。 $M$ が大きいので周期を陽に持つと間に合いませんが、周期の $i$ 番目がどのような値になるかが高速に求められるとよさそうです。

## ヒント2

数列 $A$ に含まれる値の種類数を $X$ として、周期の前から $M-X$ 個とそれ以降で分けて考えます。  
周期の前から $M-X$ 個は、 $A$ に含まれない値を小さい順に並べたものになります。それ以降は $A$ に含まれる値を最後に現れるインデックスの小さい順に並べたものになります。これらはどのように計算すればよいでしょうか。

## ヒント3

$i$ ($1\le i \le N$)日目の日直は $A_i$ です。$i$ ($> N$) 日目以降は、 $M$ 人の生徒が周期的に選ばれます。その周期がどのようになるかを求めることができれば、 $i$ ($> N$) 日目の日直は 周期の$(i-N \mod{M})$番目が答えとなります。

数列 $A$ に含まれる値の種類数を $X$ とします。周期の前から $M-X$ 個は $A$ に含まれない値を小さい順に並べたものになります。それ以降は $A$ の各値に対して最後に表れるインデックスをキーとしてソートした順に並べたものになります。

前半 $M-X$ 個について、 $A$ に含まれていない $M$ 以下の値を適切に管理することができれば高速に求めることができます。 $A$ に含まれていない $M$ 以下の値を区間として ([$l$,$r$] に含まれる整数は $A$ に含まれない) として管理します。それに加えて各区間の右端の値 $r$ 以下の $A$ に含まれていない整数の個数を管理します。これによって二分探索を用いることにより、 周期における$i$ ($1\le i \le M-X$) 番目の出席番号を $O(\log{N})$ で求めることができます。

後半 $X$ 個については前計算としてソートをすることで $O(1)$ で求めることができます。

以上よりクエリ $O(\log{N})$ で答えを求めることができるので、全体の計算量は $O(N\log{N} + Q \log{N})$ となります。
